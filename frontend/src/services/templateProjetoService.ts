// @ts-nocheck
// üöÄ ARCFLOW - SISTEMA DE TEMPLATES DE PROJETOS INTELIGENTES
// Sistema revolucion√°rio que gera projetos automaticamente baseado no briefing

// üéØ SERVI√áO DE TEMPLATES DE PROJETO
// Gera etapas e tarefas automaticamente baseado no briefing preenchido

interface BriefingAnalysisResult {
  tipologia: string;
  subtipo: string;
  area: number;
  padrao: 'SIMPLES' | 'MEDIO' | 'ALTO_PADRAO' | 'PREMIUM';
  disciplinas: string[];
  complexidade: 'BAIXA' | 'MEDIA' | 'ALTA' | 'MUITO_ALTA';
  prazoEstimado: number;
  valorEstimado: number;
}

interface TarefaTemplate {
  id: string;
  nome: string;
  descricao: string;
  disciplina: string;
  estimativaHoras: number;
  prioridade: 'BAIXA' | 'NORMAL' | 'ALTA' | 'CRITICA';
  dependeDe: string[];
  obrigatoria: boolean;
  condicoes?: string[];
}

interface EtapaTemplate {
  id: string;
  nome: string;
  descricao: string;
  ordem: number;
  disciplinas: string[];
  prazoEstimado: number;
  tarefas: TarefaTemplate[];
  obrigatoria: boolean;
  dependeDe: string[];
  condicoes?: string[];
}

interface TemplateProjetoCompleto {
  id: string;
  nome: string;
  tipologia: string;
  subtipo: string;
  padrao: string;
  etapas: EtapaTemplate[];
  prazoTotal: number;
  valorEstimado: number;
  disciplinasEnvolvidas: string[];
  observacoes: string[];
}

// üìã TEMPLATES DE PROJETOS POR TIPOLOGIA
const TEMPLATES_RESIDENCIAL = {
  CASA_SIMPLES: {
    id: 'RES_CASA_SIMPLES',
    nome: 'Casa Unifamiliar - Padr√£o Simples',
    tipologia: 'RESIDENCIAL',
    subtipo: 'CASA_UNIFAMILIAR',
    padrao: 'SIMPLES',
    etapas: [
      {
        id: 'lv',
        nome: 'Levantamento de Dados',
        descricao: 'Coleta de informa√ß√µes e briefing detalhado',
        ordem: 1,
        disciplinas: ['ARQ'],
        prazoEstimado: 10,
        obrigatoria: true,
        dependeDe: [],
        tarefas: [
          {
            id: 'lv-01',
            nome: 'Briefing Detalhado com Cliente',
            descricao: 'Reuni√£o para entender necessidades, estilo de vida e expectativas',
            disciplina: 'ARQ',
            estimativaHoras: 8,
            prioridade: 'CRITICA',
            dependeDe: [],
            obrigatoria: true
          },
          {
            id: 'lv-02',
            nome: 'Levantamento Topogr√°fico',
            descricao: 'Medi√ß√£o e an√°lise das condi√ß√µes do terreno',
            disciplina: 'ARQ',
            estimativaHoras: 12,
            prioridade: 'ALTA',
            dependeDe: ['lv-01'],
            obrigatoria: true
          },
          {
            id: 'lv-03',
            nome: 'An√°lise Legal e Urban√≠stica',
            descricao: 'Verifica√ß√£o de restri√ß√µes e regulamenta√ß√µes municipais',
            disciplina: 'ARQ',
            estimativaHoras: 6,
            prioridade: 'ALTA',
            dependeDe: ['lv-02'],
            obrigatoria: true
          },
          {
            id: 'lv-04',
            nome: 'Estudo de Viabilidade',
            descricao: 'An√°lise de viabilidade t√©cnica e econ√¥mica do projeto',
            disciplina: 'ARQ',
            estimativaHoras: 4,
            prioridade: 'ALTA',
            dependeDe: ['lv-03'],
            obrigatoria: true
          }
        ]
      },
      {
        id: 'ep',
        nome: 'Estudo Preliminar',
        descricao: 'Primeira proposta arquitet√¥nica e conceitual',
        ordem: 2,
        disciplinas: ['ARQ'],
        prazoEstimado: 15,
        obrigatoria: true,
        dependeDe: ['lv'],
        tarefas: [
          {
            id: 'ep-01',
            nome: 'Estudo de Massas e Implanta√ß√£o',
            descricao: 'Defini√ß√£o da volumetria e posicionamento no terreno',
            disciplina: 'ARQ',
            estimativaHoras: 16,
            prioridade: 'CRITICA',
            dependeDe: [],
            obrigatoria: true
          },
          {
            id: 'ep-02',
            nome: 'Plantas Conceituais',
            descricao: 'Desenho das plantas baixas preliminares',
            disciplina: 'ARQ',
            estimativaHoras: 20,
            prioridade: 'CRITICA',
            dependeDe: ['ep-01'],
            obrigatoria: true
          },
          {
            id: 'ep-03',
            nome: 'Fachadas Conceituais',
            descricao: 'Estudo das eleva√ß√µes principais',
            disciplina: 'ARQ',
            estimativaHoras: 12,
            prioridade: 'ALTA',
            dependeDe: ['ep-02'],
            obrigatoria: true
          },
          {
            id: 'ep-04',
            nome: 'Apresenta√ß√£o ao Cliente',
            descricao: 'Apresenta√ß√£o da proposta preliminar para aprova√ß√£o',
            disciplina: 'ARQ',
            estimativaHoras: 4,
            prioridade: 'CRITICA',
            dependeDe: ['ep-03'],
            obrigatoria: true
          }
        ]
      },
      {
        id: 'ap',
        nome: 'Anteprojeto',
        descricao: 'Desenvolvimento da proposta com detalhamentos b√°sicos',
        ordem: 3,
        disciplinas: ['ARQ', 'EST'],
        prazoEstimado: 25,
        obrigatoria: true,
        dependeDe: ['ep'],
        tarefas: [
          {
            id: 'ap-01',
            nome: 'Plantas Detalhadas',
            descricao: 'Desenvolvimento completo das plantas baixas',
            disciplina: 'ARQ',
            estimativaHoras: 32,
            prioridade: 'CRITICA',
            dependeDe: [],
            obrigatoria: true
          },
          {
            id: 'ap-02',
            nome: 'Cortes e Fachadas',
            descricao: 'Desenhos t√©cnicos de cortes e eleva√ß√µes',
            disciplina: 'ARQ',
            estimativaHoras: 24,
            prioridade: 'ALTA',
            dependeDe: ['ap-01'],
            obrigatoria: true
          },
          {
            id: 'ap-03',
            nome: 'Estrutura Preliminar',
            descricao: 'Dimensionamento estrutural b√°sico',
            disciplina: 'EST',
            estimativaHoras: 20,
            prioridade: 'ALTA',
            dependeDe: ['ap-01'],
            obrigatoria: true
          },
          {
            id: 'ap-04',
            nome: 'Especifica√ß√µes B√°sicas',
            descricao: 'Defini√ß√£o de materiais e acabamentos principais',
            disciplina: 'ARQ',
            estimativaHoras: 8,
            prioridade: 'NORMAL',
            dependeDe: ['ap-02'],
            obrigatoria: true
          }
        ]
      },
      {
        id: 'pe',
        nome: 'Projeto Executivo',
        descricao: 'Projeto completo para execu√ß√£o da obra',
        ordem: 4,
        disciplinas: ['ARQ', 'EST', 'ELE', 'HID'],
        prazoEstimado: 45,
        obrigatoria: true,
        dependeDe: ['ap'],
        tarefas: [
          {
            id: 'pe-01',
            nome: 'Detalhamento Arquitet√¥nico',
            descricao: 'Plantas, cortes e detalhes executivos completos',
            disciplina: 'ARQ',
            estimativaHoras: 60,
            prioridade: 'CRITICA',
            dependeDe: [],
            obrigatoria: true
          },
          {
            id: 'pe-02',
            nome: 'Projeto Estrutural',
            descricao: 'C√°lculo e detalhamento da estrutura',
            disciplina: 'EST',
            estimativaHoras: 40,
            prioridade: 'CRITICA',
            dependeDe: [],
            obrigatoria: true
          },
          {
            id: 'pe-03',
            nome: 'Projeto El√©trico',
            descricao: 'Sistema el√©trico completo',
            disciplina: 'ELE',
            estimativaHoras: 32,
            prioridade: 'ALTA',
            dependeDe: ['pe-01'],
            obrigatoria: true
          },
          {
            id: 'pe-04',
            nome: 'Projeto Hidrossanit√°rio',
            descricao: 'Instala√ß√µes hidr√°ulicas e sanit√°rias',
            disciplina: 'HID',
            estimativaHoras: 28,
            prioridade: 'ALTA',
            dependeDe: ['pe-01'],
            obrigatoria: true
          },
          {
            id: 'pe-05',
            nome: 'Compatibiliza√ß√£o Final',
            descricao: 'Revis√£o e compatibiliza√ß√£o de todos os projetos',
            disciplina: 'ARQ',
            estimativaHoras: 16,
            prioridade: 'CRITICA',
            dependeDe: ['pe-01', 'pe-02', 'pe-03', 'pe-04'],
            obrigatoria: true
          }
        ]
      }
    ],
    prazoTotal: 95,
    valorEstimado: 25000,
    disciplinasEnvolvidas: ['ARQ', 'EST', 'ELE', 'HID'],
    observacoes: [
      'Template otimizado para casas de 80-200m¬≤',
      'Estrutura convencional em concreto armado',
      'Instala√ß√µes b√°sicas residenciais',
      'Aprova√ß√£o municipal simplificada'
    ]
  },

  CASA_ALTO_PADRAO: {
    id: 'RES_CASA_ALTO_PADRAO',
    nome: 'Casa Unifamiliar - Alto Padr√£o',
    tipologia: 'RESIDENCIAL',
    subtipo: 'CASA_UNIFAMILIAR',
    padrao: 'ALTO_PADRAO',
    etapas: [
      {
        id: 'lv',
        nome: 'Levantamento de Dados',
        descricao: 'Coleta de informa√ß√µes e briefing detalhado',
        ordem: 1,
        disciplinas: ['ARQ'],
        prazoEstimado: 15,
        obrigatoria: true,
        dependeDe: [],
        tarefas: [
          {
            id: 'lv-01',
            nome: 'Briefing Completo com Cliente',
            descricao: 'Reuni√£o detalhada para entender lifestyle e necessidades espec√≠ficas',
            disciplina: 'ARQ',
            estimativaHoras: 12,
            prioridade: 'CRITICA',
            dependeDe: [],
            obrigatoria: true
          },
          {
            id: 'lv-02',
            nome: 'Levantamento Topogr√°fico Detalhado',
            descricao: 'Levantamento planialtim√©trico completo com sondagem',
            disciplina: 'ARQ',
            estimativaHoras: 16,
            prioridade: 'CRITICA',
            dependeDe: ['lv-01'],
            obrigatoria: true
          },
          {
            id: 'lv-03',
            nome: 'An√°lise Legal Completa',
            descricao: 'Verifica√ß√£o de todas as restri√ß√µes legais e urban√≠sticas',
            disciplina: 'ARQ',
            estimativaHoras: 10,
            prioridade: 'ALTA',
            dependeDe: ['lv-02'],
            obrigatoria: true
          },
          {
            id: 'lv-04',
            nome: 'Estudo de Insola√ß√£o e Ventila√ß√£o',
            descricao: 'An√°lise bioclim√°tica do terreno',
            disciplina: 'ARQ',
            estimativaHoras: 8,
            prioridade: 'ALTA',
            dependeDe: ['lv-02'],
            obrigatoria: true
          },
          {
            id: 'lv-05',
            nome: 'An√°lise de Vizinhan√ßa',
            descricao: 'Estudo do entorno e impacto na concep√ß√£o',
            disciplina: 'ARQ',
            estimativaHoras: 6,
            prioridade: 'NORMAL',
            dependeDe: ['lv-03'],
            obrigatoria: true
          }
        ]
      },
      // Adicionar mais etapas para alto padr√£o...
    ],
    prazoTotal: 150,
    valorEstimado: 80000,
    disciplinasEnvolvidas: ['ARQ', 'EST', 'ELE', 'HID', 'AVAC', 'PCI', 'PAISAG', 'AUTOM'],
    observacoes: [
      'Template para casas acima de 300m¬≤',
      'Inclui sistemas especiais (automa√ß√£o, AVAC, etc.)',
      'Paisagismo e projeto de interiores integrados',
      'Aprova√ß√µes m√∫ltiplas necess√°rias'
    ]
  }
};

const TEMPLATES_COMERCIAL = {
  ESCRITORIO_SIMPLES: {
    id: 'COM_ESCRITORIO_SIMPLES',
    nome: 'Escrit√≥rio Comercial - Padr√£o Simples',
    tipologia: 'COMERCIAL',
    subtipo: 'ESCRITORIO',
    padrao: 'SIMPLES',
    etapas: [
      {
        id: 'lv',
        nome: 'Levantamento de Dados',
        descricao: 'An√°lise do neg√≥cio e necessidades espaciais',
        ordem: 1,
        disciplinas: ['ARQ'],
        prazoEstimado: 8,
        obrigatoria: true,
        dependeDe: [],
        tarefas: [
          {
            id: 'lv-01',
            nome: 'Briefing Empresarial',
            descricao: 'Entendimento do neg√≥cio, cultura e necessidades',
            disciplina: 'ARQ',
            estimativaHoras: 6,
            prioridade: 'CRITICA',
            dependeDe: [],
            obrigatoria: true
          },
          {
            id: 'lv-02',
            nome: 'An√°lise de Fluxo de Trabalho',
            descricao: 'Estudo dos processos e fluxos internos',
            disciplina: 'ARQ',
            estimativaHoras: 8,
            prioridade: 'ALTA',
            dependeDe: ['lv-01'],
            obrigatoria: true
          },
          {
            id: 'lv-03',
            nome: 'Levantamento do Espa√ßo Existente',
            descricao: 'Medi√ß√£o e an√°lise das condi√ß√µes atuais',
            disciplina: 'ARQ',
            estimativaHoras: 4,
            prioridade: 'ALTA',
            dependeDe: ['lv-01'],
            obrigatoria: true
          }
        ]
      }
      // Adicionar mais etapas...
    ],
    prazoTotal: 60,
    valorEstimado: 15000,
    disciplinasEnvolvidas: ['ARQ', 'ELE', 'AVAC'],
    observacoes: [
      'Template para escrit√≥rios at√© 200m¬≤',
      'Foco em produtividade e bem-estar',
      'Normas de acessibilidade aplicadas'
    ]
  }
};

export class TemplateProjetoService {
  
  // üéØ M√âTODO PRINCIPAL: GERAR PROJETO BASEADO NO BRIEFING
  static gerarProjetoFromBriefing(briefingData: any): TemplateProjetoCompleto {
    // 1. Analisar o briefing
    const analysis = this.analisarBriefing(briefingData);
    
    // 2. Selecionar template apropriado
    const template = this.selecionarTemplate(analysis);
    
    // 3. Personalizar template baseado no briefing
    const projetoPersonalizado = this.personalizarTemplate(template, briefingData, analysis);
    
    return projetoPersonalizado;
  }

  // üîç ANALISAR BRIEFING PARA EXTRAIR INFORMA√á√ïES CHAVE
  private static analisarBriefing(briefingData: any): BriefingAnalysisResult {
    // Extrair informa√ß√µes do briefing preenchido
    const tipologia = this.extrairTipologia(briefingData);
    const subtipo = this.extrairSubtipo(briefingData);
    const area = this.extrairArea(briefingData);
    const padrao = this.extrairPadrao(briefingData);
    const disciplinas = this.extrairDisciplinas(briefingData);
    const complexidade = this.calcularComplexidade(briefingData);
    
    return {
      tipologia,
      subtipo,
      area,
      padrao,
      disciplinas,
      complexidade,
      prazoEstimado: this.calcularPrazoEstimado(complexidade, disciplinas),
      valorEstimado: this.calcularValorEstimado(area, padrao, disciplinas)
    };
  }

  // üìã SELECIONAR TEMPLATE APROPRIADO
  private static selecionarTemplate(analysis: BriefingAnalysisResult): TemplateProjetoCompleto {
    const templateKey = `${analysis.subtipo}_${analysis.padrao}`;
    
    if (analysis.tipologia === 'RESIDENCIAL') {
      return TEMPLATES_RESIDENCIAL[templateKey as keyof typeof TEMPLATES_RESIDENCIAL] || TEMPLATES_RESIDENCIAL.CASA_SIMPLES as TemplateProjetoCompleto;
    }
    
    if (analysis.tipologia === 'COMERCIAL') {
      return TEMPLATES_COMERCIAL[templateKey as keyof typeof TEMPLATES_COMERCIAL] || TEMPLATES_COMERCIAL.ESCRITORIO_SIMPLES as TemplateProjetoCompleto;
    }
    
    // Fallback para template b√°sico
    return TEMPLATES_RESIDENCIAL.CASA_SIMPLES as TemplateProjetoCompleto;
  }

  // ‚öôÔ∏è PERSONALIZAR TEMPLATE BASEADO NO BRIEFING
  private static personalizarTemplate(
    template: TemplateProjetoCompleto, 
    briefingData: any, 
    analysis: BriefingAnalysisResult
  ): TemplateProjetoCompleto {
    
    const templatePersonalizado = JSON.parse(JSON.stringify(template)); // Deep clone
    
    // 1. Ajustar disciplinas baseado no briefing
    templatePersonalizado.disciplinasEnvolvidas = analysis.disciplinas;
    
    // 2. Adicionar/remover etapas baseado nas necessidades
    templatePersonalizado.etapas = this.ajustarEtapas(template.etapas, briefingData, analysis);
    
    // 3. Personalizar tarefas baseado nas respostas
    templatePersonalizado.etapas.forEach(etapa => {
      etapa.tarefas = this.personalizarTarefas(etapa.tarefas, briefingData, analysis);
    });
    
    // 4. Recalcular prazos e valores
    templatePersonalizado.prazoTotal = this.calcularPrazoTotal(templatePersonalizado.etapas);
    templatePersonalizado.valorEstimado = analysis.valorEstimado;
    
    return templatePersonalizado;
  }

  // üîß M√âTODOS AUXILIARES DE EXTRA√á√ÉO
  private static extrairTipologia(briefingData: any): string {
    // L√≥gica para extrair tipologia do briefing
    if (briefingData.area === 'RESIDENCIAL') return 'RESIDENCIAL';
    if (briefingData.area === 'COMERCIAL') return 'COMERCIAL';
    if (briefingData.area === 'INDUSTRIAL') return 'INDUSTRIAL';
    return 'RESIDENCIAL'; // default
  }

  private static extrairSubtipo(briefingData: any): string {
    // L√≥gica para extrair subtipo
    if (briefingData.tipologia === 'CASA_UNIFAMILIAR') return 'CASA_UNIFAMILIAR';
    if (briefingData.tipologia === 'APARTAMENTO') return 'APARTAMENTO';
    if (briefingData.tipologia === 'ESCRITORIO') return 'ESCRITORIO';
    return 'CASA_UNIFAMILIAR'; // default
  }

  private static extrairArea(briefingData: any): number {
    // Extrair √°rea do briefing
    const areaResposta = briefingData.respostas?.find((r: any) => 
      r.perguntaId?.includes('AREA') || r.perguntaId?.includes('area')
    );
    return areaResposta?.valor || 150; // default
  }

  private static extrairPadrao(briefingData: any): 'SIMPLES' | 'MEDIO' | 'ALTO_PADRAO' | 'PREMIUM' {
    // L√≥gica para determinar padr√£o baseado no or√ßamento e respostas
    const orcamentoResposta = briefingData.respostas?.find((r: any) => 
      r.perguntaId?.includes('ORCAMENTO') || r.perguntaId?.includes('orcamento')
    );
    
    const orcamento = orcamentoResposta?.valor || 0;
    
    if (orcamento < 500000) return 'SIMPLES';
    if (orcamento < 1000000) return 'MEDIO';
    if (orcamento < 2000000) return 'ALTO_PADRAO';
    return 'PREMIUM';
  }

  private static extrairDisciplinas(briefingData: any): string[] {
    const disciplinas = ['ARQ']; // Sempre inclui arquitetura
    
    // L√≥gica para adicionar disciplinas baseado nas respostas
    const respostas = briefingData.respostas || [];
    
    // Verificar necessidade de estrutura
    if (respostas.some((r: any) => r.valor === true && r.perguntaId?.includes('estrutura'))) {
      disciplinas.push('EST');
    }
    
    // Verificar necessidade de el√©trica
    if (respostas.some((r: any) => r.valor === true && r.perguntaId?.includes('eletrica'))) {
      disciplinas.push('ELE');
    }
    
    // Verificar necessidade de hidr√°ulica
    if (respostas.some((r: any) => r.valor === true && r.perguntaId?.includes('hidraulica'))) {
      disciplinas.push('HID');
    }
    
    // Verificar necessidade de AVAC
    if (respostas.some((r: any) => r.valor === true && r.perguntaId?.includes('climatizacao'))) {
      disciplinas.push('AVAC');
    }
    
    return disciplinas;
  }

  private static calcularComplexidade(briefingData: any): 'BAIXA' | 'MEDIA' | 'ALTA' | 'MUITO_ALTA' {
    // L√≥gica para calcular complexidade baseado em m√∫ltiplos fatores
    let pontuacao = 0;
    
    const respostas = briefingData.respostas || [];
    
    // Fatores que aumentam complexidade
    if (respostas.length > 100) pontuacao += 2;
    if (respostas.some((r: any) => r.perguntaId?.includes('automacao'))) pontuacao += 3;
    if (respostas.some((r: any) => r.perguntaId?.includes('piscina'))) pontuacao += 2;
    if (respostas.some((r: any) => r.perguntaId?.includes('sustentabilidade'))) pontuacao += 2;
    
    if (pontuacao <= 2) return 'BAIXA';
    if (pontuacao <= 5) return 'MEDIA';
    if (pontuacao <= 8) return 'ALTA';
    return 'MUITO_ALTA';
  }

  private static calcularPrazoEstimado(complexidade: string, disciplinas: string[]): number {
    let prazoBase = 60; // dias
    
    // Ajustar baseado na complexidade
    switch (complexidade) {
      case 'BAIXA': prazoBase = 45; break;
      case 'MEDIA': prazoBase = 75; break;
      case 'ALTA': prazoBase = 120; break;
      case 'MUITO_ALTA': prazoBase = 180; break;
    }
    
    // Adicionar tempo por disciplina extra
    prazoBase += (disciplinas.length - 1) * 15;
    
    return prazoBase;
  }

  private static calcularValorEstimado(area: number, padrao: string, disciplinas: string[]): number {
    let valorPorM2 = 150; // valor base por m¬≤
    
    // Ajustar baseado no padr√£o
    switch (padrao) {
      case 'SIMPLES': valorPorM2 = 120; break;
      case 'MEDIO': valorPorM2 = 200; break;
      case 'ALTO_PADRAO': valorPorM2 = 350; break;
      case 'PREMIUM': valorPorM2 = 500; break;
    }
    
    // Adicionar valor por disciplina
    const valorDisciplinas = disciplinas.length * 2000;
    
    return (area * valorPorM2) + valorDisciplinas;
  }

  private static ajustarEtapas(etapas: EtapaTemplate[], briefingData: any, analysis: BriefingAnalysisResult): EtapaTemplate[] {
    // L√≥gica para adicionar/remover etapas baseado no briefing
    let etapasAjustadas = [...etapas];
    
    // Adicionar etapa de paisagismo se necess√°rio
    if (briefingData.respostas?.some((r: any) => r.perguntaId?.includes('paisagismo') && r.valor === true)) {
      etapasAjustadas.push({
        id: 'paisag',
        nome: 'Projeto Paisag√≠stico',
        descricao: 'Projeto de paisagismo e jardins',
        ordem: etapas.length + 1,
        disciplinas: ['PAISAG'],
        prazoEstimado: 20,
        obrigatoria: false,
        dependeDe: ['pe'],
        tarefas: [
          {
            id: 'paisag-01',
            nome: 'Projeto de Paisagismo',
            descricao: 'Desenvolvimento do projeto paisag√≠stico',
            disciplina: 'PAISAG',
            estimativaHoras: 24,
            prioridade: 'NORMAL',
            dependeDe: [],
            obrigatoria: true
          }
        ]
      });
    }
    
    return etapasAjustadas;
  }

  private static personalizarTarefas(tarefas: TarefaTemplate[], briefingData: any, analysis: BriefingAnalysisResult): TarefaTemplate[] {
    // L√≥gica para personalizar tarefas baseado nas respostas
    return tarefas.map(tarefa => {
      // Ajustar estimativa de horas baseado na complexidade
      let multiplicador = 1;
      
      switch (analysis.complexidade) {
        case 'BAIXA': multiplicador = 0.8; break;
        case 'MEDIA': multiplicador = 1.0; break;
        case 'ALTA': multiplicador = 1.3; break;
        case 'MUITO_ALTA': multiplicador = 1.6; break;
      }
      
      return {
        ...tarefa,
        estimativaHoras: Math.round(tarefa.estimativaHoras * multiplicador)
      };
    });
  }

  private static calcularPrazoTotal(etapas: EtapaTemplate[]): number {
    return etapas.reduce((total, etapa) => total + etapa.prazoEstimado, 0);
  }

  // üéØ M√âTODO PARA OBTER TEMPLATES DISPON√çVEIS
  static obterTemplatesDisponiveis() {
    return {
      RESIDENCIAL: Object.keys(TEMPLATES_RESIDENCIAL).map(key => ({
        id: key,
        nome: TEMPLATES_RESIDENCIAL[key as keyof typeof TEMPLATES_RESIDENCIAL].nome,
        prazo: TEMPLATES_RESIDENCIAL[key as keyof typeof TEMPLATES_RESIDENCIAL].prazoTotal,
        valor: TEMPLATES_RESIDENCIAL[key as keyof typeof TEMPLATES_RESIDENCIAL].valorEstimado
      })),
      COMERCIAL: Object.keys(TEMPLATES_COMERCIAL).map(key => ({
        id: key,
        nome: TEMPLATES_COMERCIAL[key as keyof typeof TEMPLATES_COMERCIAL].nome,
        prazo: TEMPLATES_COMERCIAL[key as keyof typeof TEMPLATES_COMERCIAL].prazoTotal,
        valor: TEMPLATES_COMERCIAL[key as keyof typeof TEMPLATES_COMERCIAL].valorEstimado
      }))
    };
  }
}

export type { TemplateProjetoCompleto, EtapaTemplate, TarefaTemplate, BriefingAnalysisResult }; 